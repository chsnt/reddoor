{"subreddit":{"display_name":"lua"},"subreddit_loc":"принимать","selftext":"Мне трудно понять, как подойти к этому. Во-первых, общая проблема; У меня есть строка состояния, содержащая 3 отдельные строки, которые я объединяю в одну строку, эта длина может иметь максимальную ширину 100 символов. 3 отдельные строки имеют переменную длину, поэтому в настоящее время я усекаю их до 30 символов в каждой.\n\nВот мой текущий сценарий в полном объеме.\n\n    #! / USR / бен / Lua\n    требовать ( 'pl.stringx'). импорт ()\n    местный lgi = требуется ('lgi')\n    local player = lgi.Playerctl.Player {}\n    \n    \n    - декодировать URI в стандартный путь Unix\n    местный decodeURI\n    делать\n        локальный символ, gsub, tonumber = string.char, string.gsub, tonumber\n        локальная функция _ (шестнадцатеричный) возвращает символ\n    \n        функция decodeURI (s)\n            s = gsub (s, '%% (% x% x)', _)\n            s = gsub (s, 'file: //', '')\n            возврат с\n        конец\n    конец\n    \n    - проверить, доступен ли файл, если нет, вернуть\n    local raw_path = player: print_metadata_prop ('xesam: url')\n    если raw_path == ноль, то\n        возвращение\n    еще\n        путь = decodeURI (raw_path)\n    конец\n    \n    - захват системы cmd\n    функция os.capture (cmd)\n        local f = io.popen (cmd, 'r')\n        локальный s = f: read ()\n        F: закрыть ()\n        возврат с\n    конец\n    \n    - получить битрейт\n    функция string_to_decode (str)\n        local cmd = ('mediainfo --inform = \"Audio;% BitRate / String%\" \"' ..path .. '\"')\n        local buf = os.capture (cmd)\n        возврат буф\n    конец\n    \n    местное название = игрок: get_title ()\n    местный альбумартист = игрок: get_artist ()\n    локальный альбом = плеер: get_album ()\n    локальный битрейт = string_to_decode (str)\n    \n    - сопоставить значения метаданных в одну строку\n    список значений функций\n        местный т = {}\n        для k, v в ipairs (s) сделать\n            t [# t + 1] = tostring (v)\n        конец\n        возврат table.concat (t, \"/\")\n    конец\n    \n    локальные метаданные = {название: укоротить (30), альбумартист: укоротить (30), альбом: укоротить (30), битрейт}\n    \n    печать (listvalues ​​(метаданные))\n\n\nЭто просто строка состояния для печати метаданных песен. В таблице `metadata` происходит усечение. Я использую функцию «сократить» из [библиотеки penlight]  (https://github.com/stevedonovan/Penlight) . Вот функция:\n    \n    \n    функция stringx.shorten (s, w, tail)\n        assert_string (1, S)\n        если #s> w то\n            если w <n_ellipsis, то вернуть многоточие: sub (1, w) end\n            если хвост то\n                местный я = #s - w + 1 + n_ellipsis\n                вернуть многоточие .. s: sub (i)\n            еще\n                return s: sub (1, w-n_ellipsis) .. многоточие\n            конец\n        конец\n        возврат с\n    конец\n\n\nПримечание: на самом деле не имеет отношения к проблеме, но скрипт вызывается только при смене песни, поэтому опрос не задействован или что-то в этом роде. Я планирую включить в мой музыкальный демон.\n\n** ВОПРОС: **\n\nЯ частично делаю это, чтобы познакомиться с Луа. На данный момент я написал только несколько сценариев lua. Этот скрипт переписывает программу awk, которая получает данные mpris и форматирует выходные данные. Программа awk индексирует каждую переменную и усекает только самую длинную строку. например ... `Осень 1 / Макс Рихтер / Рекомендовано Максом Рихтером: Вивальд… / 320 кб / с`. Проблема с этим подходом состоит в том, что если любая из других переменных метаданных очень длинная, вы легко пройдете максимальную ширину.\n\nС моей текущей версией lua проблема по существу противоположна. Поскольку я обрезаю все отдельные переменные на 30 символов, вы можете в итоге без необходимости сокращать строку, если она не соответствует максимальным 100 символам. например. `название (5 символов) / исполнитель (5 символов) / альбом (35 символов)` is `<100`\n\nПоэтому я пытался выяснить, как динамически обрезать каждую переменную, чтобы наилучшим образом использовать преимущества полной ширины. Я знаю, что должен сначала согласовать все переменные. Тест `len> 100`. Но кроме этого я не могу понять, как лучше всего это реализовать. Часть этого переписывания была для того, чтобы выполнить это, поскольку программа awk уже была доведена до предела.\n\nЛюбые мысли о том, как подойти к этому, код или критика будут оценены. веселит.","title":"Динамически обрезать строку","subreddit_name_prefixed":"r/lua","ups":1,"created":1567676918,"link_flair_background_color":"","id":"czuamq","author":{"name":"Vredesbyyrd"},"permalink":"/r/lua/comments/czuamq/dynamically_truncate_string/","url":"https://www.reddit.com/r/lua/comments/czuamq/dynamically_truncate_string/","created_utc":1567648118}