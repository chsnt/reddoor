{"subreddit":{"display_name":"lua"},"subreddit_loc":"принимать","selftext":"Я часто пишу функцию, которая берет список ключей и значений, где важен порядок ключей. Что такое элегантный способ выразить это в Lua?\n\n«Ключи и значения» кричит «хеш-таблица». Моей первой идеей было указать специальный ключ \"_order\", который можно добавить в таблицу, его значением является массив ключей.\n\n    локальная функция doBigThing (значения)\n        локальные ключи = значения.\n        если ключи то\n            для я = 1, # ключи делают\n                doSmallThing (keys [i], значения [keys [i]])\n            конец\n        еще\n           ...\n        конец\n    конец\n\n    doBigThing ({a = 1, b = 2, c = 3, _order = {\"a\", \"b\", \"c\"}})\n\nvalues._order также может быть функцией обратного вызова, которая возвращает ключи в правильном порядке.\n\nМне не нравится избыточность необходимости писать ключи дважды.\n\n---\n\nСледующая идея заключалась в использовании varargs:\n\n    локальная функция doBigThing (...)\n        местные нары = выбрать ('#', ...)\n        для я = 1, Наргс, 2 до\n            местный k, v = выберите (я, ...)\n            doSmallThing (k, v)\n        конец\n    конец\n\n    doBigThing (\"a\", 1, \"b\", 2, \"c\", 3)\n\nЭто решение имеет большое снижение производительности в LuaJIT (его можно исправить, составив таблицу из аргументов), и это выглядит необычно. Мне это совсем не нравится.\n\n---\n\nДругая идея: использовать отдельные таблицы для ключей и значений\n\n    локальная функция doBigThing (ключи, значения)\n        для я = 1, # ключи делают\n            doSmallThing (ключи [i], значения [i])\n        конец\n    конец\n\n    doBigThing ({'a', 'b', 'c'}, {1, 2, 3})\n\nВыглядит немного лучше, чем varargs и, вероятно, довольно быстро. Хотя разделение ключей и значений натирает меня неправильно.\n\n---\n\nРедактировать: почти забыл очевидный.\n\n    локальная функция doBigThing (значения)\n        для i = 1, # значения делают\n            doSmallThing (values ​​[i] .key, values ​​[i] .value)\n        конец\n    конец\n\n    doBigThing ({\n        {key = 'a', value = 1}\n        {ключ = 'b', значение = 2}\n        {key = 'c', value = 3}\n    })\n\nЭто самое «чистое» решение, и то, что я обычно получаю в своем коде. Мне не нравится многословие и избыточность.\n\nЯ не очень доволен ни одним из них. Есть еще идеи?","title":"Ключи и значения с ключами в определенном порядке","subreddit_name_prefixed":"r/lua","ups":3,"created":1560018177,"link_flair_background_color":"","id":"by6m2v","author":{"name":"megagrump"},"permalink":"/r/lua/comments/by6m2v/keys_and_values_with_keys_in_specific_order/","url":"https://www.reddit.com/r/lua/comments/by6m2v/keys_and_values_with_keys_in_specific_order/","created_utc":1559989377}