{"subreddit":{"display_name":"Kotlin"},"subreddit_loc":"Котлин","selftext":"Я пытаюсь использовать MockK, чтобы убедиться, что объект базы данных Exposed вызывает метод connect () с ожидаемым источником данных. Источником данных является HikariDataSource, который использует HikariConf для конфигурации. Я пытался использовать объект макет и шпион, но безрезультатно. Ниже моя последняя попытка. Бьюсь об заклад, это что-то простое, что мне не хватает Любая помощь высоко ценится!\n\n    пакет com.mbtw42.tm.db\n    \n    импорт com.zaxxer.hikari.HikariConfig\n    импорт com.zaxxer.hikari.HikariDataSource\n    импорт com.zaxxer.hikari.util.DriverDataSource\n    import io.kotlintest.specs.DescribeSpec\n    импорт io.mockk. *\n    import org.jetbrains.exposed.sql.Database\n    импорт org.junit.After\n    \n    Класс DatabaseConnectionTest: DescribeSpec ({\n        @Afterfun cleanUp () = unmockkAll ()\n    \n        val testDbDriver = \"org.postgresql.Driver\"\n        val testDbUrl = \"jdbc: postgresql: // localhost: 5432 / telly_monster\"\n        val testDbUser = \"GIJoe\"\n        val testDbPassword = \"кобра !!!!\"\n        val testDbMaxPoolSize = \"10\"\n        val testHikariConfig = HikariConfig (). apply {\n            driverClassName = testDbDriver\n            jdbcUrl = testDbUrl\n            username = testDbUser\n            пароль = testDbPassword\n            maximumPoolSize = testDbMaxPoolSize.toInt ()\n            isAutoCommit = falsetransaction\n            Изоляция = \"TRANSACTION_REPEATABLE_READ\"\n        }\n    \n        mockkConstructor (DriverDataSource :: класс)\n    \n        каждый {\n            anyConstructed <DriverDataSource> (). getConnection (testDbUser, testDbPassword)\n        } возвращает mockk (relaxed = true)\n    \n        mockkObject (база данных)\n    \n        каждый {\n            Database.connect (любой <HikariDataSource> ())\n        } answers {mockk ()}\n    \n        описать (\"проверить соединение базы данных\") {\n            it («создает соединение с базой данных с помощью предоставленных конфигураций») {\n                DatabaseConnection (testHikariConfig)\n    \n                verify (atLeast = 1) {\n                    Database.connect (HikariDataSource (testHikariConfig), любой (), любой ())\n                }\n            }\n        }\n    })\n\n","title":"MockK: Убедитесь, что открытая база данных соединяется с ожидаемым источником данных","subreddit_name_prefixed":"r/Kotlin","ups":3,"created":1543881933,"link_flair_background_color":"","id":"a2pzq0","author":{"name":"mbtw42"},"permalink":"/r/Kotlin/comments/a2pzq0/mockk_verify_exposed_database_connects_with/","url":"https://www.reddit.com/r/Kotlin/comments/a2pzq0/mockk_verify_exposed_database_connects_with/","created_utc":1543853133}